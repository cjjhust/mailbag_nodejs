services:
  # ------------------------------------
  # 1. åç«¯æœåŠ¡ (Node.js API)
  # ------------------------------------
  mailbag:
    build: 
      context: ./
      dockerfile: Dockerfile.Mailbag
    container_name: mailbag_dev
    ports:
      - "3000:3000"
    # ğŸŒŸ å…³é”®ä¿®æ”¹ï¼šæŒ‡å®šå¯é çš„å¤–éƒ¨ DNS æœåŠ¡å™¨
    dns:
      - 1.1.1.1  # Cloudflare DNS (æ¨è)
      - 8.8.8.8  # Google DNS
    volumes:
      # 1. æ ¸å¿ƒä»£ç åŒæ­¥ï¼šä¸»æœº ./backend ç›®å½•å®æ—¶åŒæ­¥åˆ°å®¹å™¨ /app
      - ./:/mailbag 
      # 2. ä¾èµ–éš”ç¦»ï¼šnode_modules ä½¿ç”¨åŒ¿åå·ï¼Œå®‰è£…åœ¨å®¹å™¨å†…ï¼Œä¸æ±¡æŸ“ä¸»æœº
      - /mailbag/node_modules 
      # 3. éš”ç¦»å­ç›®å½•ä¸‹çš„ node_modulesï¼šä¸ºæ¯ä¸ªå­ç›®å½•å•ç‹¬æ·»åŠ è¦†ç›– 
      - /mailbag/client/node_modules
    
    # å¯åŠ¨å‘½ä»¤ï¼šåœ¨å¯åŠ¨æ—¶å…ˆå®‰è£…ä¾èµ–ï¼Œå†è¿è¡Œå¼€å‘è„šæœ¬
    # æ³¨æ„ï¼šè¿™é‡Œçš„ start:dev è„šæœ¬å¿…é¡»åœ¨ä½ çš„ package.json ä¸­å®šä¹‰ (å¦‚ä½¿ç”¨ nodemon)
    command: /bin/sh -c "npm run start"
    
    restart: unless-stopped

